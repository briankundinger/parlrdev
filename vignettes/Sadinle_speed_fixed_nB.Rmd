---
title: "Sadinle_speed_fixed_nB"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Sadinle_speed_fixed_nB}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```



```{r}

n1_vals <- c(500, 1000, 2000, 3000, 4000)
n2_vals <- 500
show_progress <- T
fast = F

m <- c(.05, .95, .05, .95, .05, .95, .05, .95, .05, .95)

u <- c(.99, .01, .99, .01, 
       1 - 1/30, 1/30, 1 - 1/12, 1/12, 1 - 1/15, 1/15)


levels <- c(2, 2, 2, 2, 2)


# S <- 1000; burn <- S * .1
# m_prior <- u_prior <- rep(1, length(m))
# alpha <- beta <- 1
parlr_speed_samps2 <- matrix(NA, nrow = length(n1_vals), ncol = 4)
sad_speed_samps2 <- matrix(NA, nrow = length(n1_vals), ncol = 4)

for(i in seq_along(n1_vals)){
  
  #Simulate Data
  n1 <- n1_vals[i]
  overlap <- n2/2
  
  cd <- SimulateComparisons(m, u, levels, n1, n2, overlap)
  Ztrue <- cd$Ztrue
  
  #parlr method
  ptm <- proc.time()
  Zchain <- BKSimple_hash2(cd)
  elapsed <- proc.time() - ptm
  Zhat <- BRL::linkRecords(Zchain, n1, 1, 1, 2, Inf)
  eval <- GetEvaluations(Zhat, Ztrue, n1)
  parlr_speed_samps2[i,] <- c(eval, elapsed[3])
  
  #Sadinle 2017 Method
  ptm <- proc.time()
  Zchain <- BRL::bipartiteGibbs(cd)
  elapsed <- proc.time() - ptm
  Zhat <- BRL::linkRecords(Zchain[[1]], n1, 1, 1, 2, Inf)
  eval <- GetEvaluations(Zhat, Ztrue, n1)
  sad_speed_samps2[i,] <- c(eval, elapsed[3])
  
  print(i)
}

# list(BK = parlr_speed_samps2,
#      Sadinle = sad_speed_samps2)
```

```{r}



parlr_df <- data.frame(parlr_speed_samps2, n1_vals, "parlr")
names(parlr_df) <- c("recall", "precision", "fmeasure", "time", "nA", "method")
sadinle_df <- data.frame(sad_speed_samps2, n1_vals, "sadinle")
names(sadinle_df) <- c("recall", "precision", "fmeasure", "time", "nA",  "method")

df<- rbind(parlr_df, sadinle_df)

speed_plot_fixed_nB <- df %>% 
  ggplot(aes(x = nA, y = time, color = method)) +
  geom_line(size = 1) +
  geom_point(size = 2) + 
  labs(x = expression(n[A]),
       y = "Time (seconds)",
       color = "Method", 
       title = "Speed Comparison: parlr and Sadinle 17",
       subtitle = paste0("1000 Gibbs iterations, file B size fixed")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = .5),
        plot.subtitle = element_text(hjust = .5))

ggsave(filename = "../notes/figures/speed_plot_fixed_nB.png",
       plot = speed_plot_fixed_nB)


# results_df <- df %>% 
#   pivot_longer(cols = 1:4, names_to = "metric") %>% 
#   group_by(method, metric) %>% 
#   summarize(avg = mean(value),
#             lower = quantile(value, .2),
#             upper = quantile(value, .8),
#             .groups = "drop")
#results_df
# simple_dist_table <- results_df %>%
#   kable(digits = 3,
#         caption = "Results for Simpler Distributions (Full)") %>%
#   kable_classic() %>%
#   kable_styling(full_width = F)
  #as_image(file = "../notes/figures/simple_dist_table.png")
```
