---
title: "Jody_Distributions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Jody_Distributions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r sim1}
n1 <- 900; n2 <- 200
K <- 4
n1_vec <- rep(n1/K, K)
n2_vec <- rep(n2/K, K)
overlap_vec <- rep(n2/(2*K), K)

m <- c(0.2632168, 0.7367832,
        0.002939667, 0.2647100, 0.7323503,
        0.001399841, 0.2999393, 0.6986608,
        0.030049928, 0.1272922, 0.8426578,
        0.00e+00, 1.297186e-02, 9.332276e-05, 9.869348e-01,
        0.000, 0.009658905, 0.001819794, 0.988521301,
        0.0199622862, 0.0217829508, 0.0005201899, 0.9577345731)

# u <- c(0.5643826, 0.4356174,
#        0.1110782, 0.4017335, 0.4871883,
#        0.1611171, 0.4737790, 0.3651039,
#        0.2096925, 0.4190162, 0.3712913,
#        0.3610075215, 0.0337668658, 0.0007047116, 0.6045209011,
#        0.5957447400, 0.0239889148, 0.0001713913, 0.3800949539,
#        9.695677e-01, 2.633540e-03, 1.537513e-05, 2.778341e-02)

u <- c(0.5643826, 0.4356174,
       0.1110782, 0.4017335, 0.4871883,
       0.1611171, 0.4737790, 0.3651039,
       0.2096925, 0.4190162, 0.3712913,
       9.695677e-01, 2.633540e-03, 1.537513e-05, 2.778341e-02,
       9.695677e-01, 2.633540e-03, 1.537513e-05, 2.778341e-02,
       9.695677e-01, 2.633540e-03, 1.537513e-05, 2.778341e-02)

m1 <- c(m, 0.52479436, 0.07896592, 0.07473561, 0.32150411)
m2 <- c(m, 0.69911186, 0.04020643, 0.02820451, 0.23247720)
m3 <- c(m, 0.60497166, 0.05499742, 0.02988150, 0.31014941)
m4 <- c(m, 0.37962963, 0.06944444, 0.05462963, 0.49629630)

u1 <- c(u, 0.9942882069, 0.0017485842, 0.0005182371, 0.0034449718)
u2 <- c(u, 0.9975972562, 0.0010425954, 0.0001931966, 0.0011669518)
u3 <- c(u, 0.9975994112, 0.0009873767, 0.0001657884, 0.0012474238)
u4 <- c(u, 0.9977836722, 0.0012571011, 0.0001914907, 0.0007677359)

m <- rbind(m1, m2, m3, m4)
u <- rbind(u1, u2, u3, u4)

#m <- rbind(m1, m4)
#u <- rbind(u1, u4)


levels <- c(2, 3, 3, 3, 4, 4, 4, 4)
varying_fields <- 24:27

iter <- 1
S <- 200; burn <- S * .1
m_prior <- u_prior <- rep(1, dim(m)[2])
alpha <- beta <- 1
EVAL.SAMPS5 <- array(NA, dim = c(iter, 3, 2))
for(i in 1:iter){
  comparisons <- SimulateComparisonsLC(m, u, levels, varying_fields, 
                                       n1, n2, n1_vec, n2_vec, overlap_vec)
  Ztrue <- comparisons[[5]]
  
  Zchain <- BRACS_BK(comparisons, m_prior, u_prior, alpha, beta, S, burn)
  Zhat <- BRL::linkRecords(Zchain, n1, 1, 1, 2, Inf)
  eval_lc <- GetEvaluations(Zhat, Ztrue, n1)
  EVAL.SAMPS5[i, , 1] <- eval_lc
  
  Zchain <- BKSimple(comparisons, m_prior, u_prior, alpha, beta, S, burn)
  Zhat <- BRL::linkRecords(Zchain, n1, 1, 1, 2, Inf)
  eval_nlc <- GetEvaluations(Zhat, Ztrue, n1)
  EVAL.SAMPS5[i, , 2] <- eval_lc
  print(i)
}
EVAL.SAMPS5
```




```{r sim2}
n1 <- 900; n2 <- 200
K <- 4
n1_vec <- rep(n1/K, K)
n2_vec <- rep(n2/K, K)
overlap_vec <- rep(n2/(2*K), K)

m <- c(0.2632168, 0.7367832,
        0.002939667, 0.2647100, 0.7323503,
        0.001399841, 0.2999393, 0.6986608,
        0.030049928, 0.1272922, 0.8426578,
        0.00e+00, 1.297186e-02, 9.332276e-05, 9.869348e-01,
        0.000, 0.009658905, 0.001819794, 0.988521301,
        0.0199622862, 0.0217829508, 0.0005201899, 0.9577345731)

u <- c(0.5643826, 0.4356174,
       0.1110782, 0.4017335, 0.4871883,
       0.1611171, 0.4737790, 0.3651039,
       0.2096925, 0.4190162, 0.3712913,
       0.3610075215, 0.0337668658, 0.0007047116, 0.6045209011,
       0.5957447400, 0.0239889148, 0.0001713913, 0.3800949539,
       9.695677e-01, 2.633540e-03, 1.537513e-05, 2.778341e-02)

# u <- c(0.5643826, 0.4356174,
#        0.1110782, 0.4017335, 0.4871883,
#        0.1611171, 0.4737790, 0.3651039,
#        0.2096925, 0.4190162, 0.3712913,
#        9.695677e-01, 2.633540e-03, 1.537513e-05, 2.778341e-02,
#        #9.695677e-01, 2.633540e-03, 1.537513e-05, 2.778341e-02,
#        9.695677e-01, 2.633540e-03, 1.537513e-05, 2.778341e-02)

m1 <- c(m, 0.52479436, 0.07896592, 0.07473561, 0.32150411)
m2 <- c(m, 0.69911186, 0.04020643, 0.02820451, 0.23247720)
m3 <- c(m, 0.60497166, 0.05499742, 0.02988150, 0.31014941)
m4 <- c(m, 0.37962963, 0.06944444, 0.05462963, 0.49629630)

u1 <- c(u, 0.9942882069, 0.0017485842, 0.0005182371, 0.0034449718)
u2 <- c(u, 0.9975972562, 0.0010425954, 0.0001931966, 0.0011669518)
u3 <- c(u, 0.9975994112, 0.0009873767, 0.0001657884, 0.0012474238)
u4 <- c(u, 0.9977836722, 0.0012571011, 0.0001914907, 0.0007677359)

m <- rbind(m1, m2, m3, m4)
u <- rbind(u1, u2, u3, u4)

#m <- rbind(m1, m4)
#u <- rbind(u1, u4)


levels <- c(2, 3, 3, 3, 4, 4, 4, 4)
varying_fields <- 24:27

iter <- 1
S <- 200; burn <- S * .1
m_prior <- u_prior <- rep(1, dim(m)[2])
alpha <- beta <- 1
EVAL.SAMPS5 <- array(NA, dim = c(iter, 3, 2))
for(i in 1:iter){
  comparisons <- SimulateComparisonsLC(m, u, levels, varying_fields, 
                                       n1, n2, n1_vec, n2_vec, overlap_vec)
  Ztrue <- comparisons[[5]]
  
  Zchain <- BRACS_BK(comparisons, m_prior, u_prior, alpha, beta, S, burn)
  Zhat <- BRL::linkRecords(Zchain, n1, 1, 1, 2, Inf)
  eval_lc <- GetEvaluations(Zhat, Ztrue, n1)
  EVAL.SAMPS5[i, , 1] <- eval_lc
  
  Zchain <- BKSimple(comparisons, m_prior, u_prior, alpha, beta, S, burn)
  Zhat <- BRL::linkRecords(Zchain, n1, 1, 1, 2, Inf)
  eval_nlc <- GetEvaluations(Zhat, Ztrue, n1)
  EVAL.SAMPS5[i, , 2] <- eval_lc
  print(i)
}
EVAL.SAMPS5
```


```{r sim2}
n1 <- 500; n2 <- 500
K <- 2
n1_vec <- rep(n1/K, K)
n2_vec <- rep(n2/K, K)
overlap_vec <- rep(n2/(2*K), K)

m <- c(0.2632168, 0.7367832,
        0.002939667, 0.2647100, 0.7323503,
        0.001399841, 0.2999393, 0.6986608,
        0.030049928, 0.1272922, 0.8426578,
        0.00e+00, 1.297186e-02, 9.332276e-05, 9.869348e-01,
        #0.000, 0.009658905, 0.001819794, 0.988521301,
        0.0199622862, 0.0217829508, 0.0005201899, 0.9577345731)

# u <- c(0.5643826, 0.4356174,
#        0.1110782, 0.4017335, 0.4871883,
#        0.1611171, 0.4737790, 0.3651039,
#        0.2096925, 0.4190162, 0.3712913,
#        0.3610075215, 0.0337668658, 0.0007047116, 0.6045209011,
#        0.5957447400, 0.0239889148, 0.0001713913, 0.3800949539,
#        9.695677e-01, 2.633540e-03, 1.537513e-05, 2.778341e-02)

u <- c(0.5643826, 0.4356174,
       0.1110782, 0.4017335, 0.4871883,
       0.1611171, 0.4737790, 0.3651039,
       0.2096925, 0.4190162, 0.3712913,
       9.695677e-01, 2.633540e-03, 1.537513e-05, 2.778341e-02,
       #9.695677e-01, 2.633540e-03, 1.537513e-05, 2.778341e-02,
       9.695677e-01, 2.633540e-03, 1.537513e-05, 2.778341e-02)

m1 <- c(m, 0.52479436, 0.07896592, 0.07473561, 0.32150411)
m2 <- c(m, 0.69911186, 0.04020643, 0.02820451, 0.23247720)
m3 <- c(m, 0.60497166, 0.05499742, 0.02988150, 0.31014941)
m4 <- c(m, 0.37962963, 0.06944444, 0.05462963, 0.49629630)

u1 <- c(u, 0.9942882069, 0.0017485842, 0.0005182371, 0.0034449718)
u2 <- c(u, 0.9975972562, 0.0010425954, 0.0001931966, 0.0011669518)
u3 <- c(u, 0.9975994112, 0.0009873767, 0.0001657884, 0.0012474238)
u4 <- c(u, 0.9977836722, 0.0012571011, 0.0001914907, 0.0007677359)

# m <- rbind(m1, m2, m3, m4)
# u <- rbind(u1, u2, u3, u4)

m <- rbind(m2, m4)
u <- rbind(u2, u4)


levels <- c(2, 3, 3, 3, 4, 4, 4)
varying_fields <- 20:23

iter <- 1
S <- 200; burn <- S * .1
m_prior <- u_prior <- rep(1, dim(m)[2])
alpha <- beta <- 1
EVAL.SAMPS5 <- array(NA, dim = c(iter, 3, 2))
for(i in 1:iter){
  comparisons <- SimulateComparisonsLC(m, u, levels, varying_fields, 
                                       n1, n2, n1_vec, n2_vec, overlap_vec)
  Ztrue <- comparisons[[5]]
  
  Zchain <- BRACS_BK(comparisons, m_prior, u_prior, alpha, beta, S, burn)
  Zhat <- BRL::linkRecords(Zchain, n1, 1, 1, 2, Inf)
  eval_lc <- GetEvaluations(Zhat, Ztrue, n1)
  EVAL.SAMPS5[i, , 1] <- eval_lc
  
  Zchain <- BKSimple(comparisons, m_prior, u_prior, alpha, beta, S, burn)
  Zhat <- BRL::linkRecords(Zchain, n1, 1, 1, 2, Inf)
  eval_nlc <- GetEvaluations(Zhat, Ztrue, n1)
  EVAL.SAMPS5[i, , 2] <- eval_lc
  print(i)
}
EVAL.SAMPS5
```


